<!DOCTYPE html>
<html>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	
	<body>
		<div>
			<canvas id="myChart"></canvas>
		</div>
		<script>		
			// Hide loader from screen.
			function hideloader() 
			{
				document.getElementById('loading').style.display = 'none';
			}
		
			const ctx = document.getElementById('myChart');
			
			const ChartConfig = {
				// "bar", "line", "pie", "doughnut", "polarArea", "radar"
				type: 'bar',
				data: 
				{
					labels: [],
					datasets: [
					{
						yAxisID: "y1",
						label: '# of Votes',
						data: [],
						borderWidth: 3
					}
				]
				},

				options: 
				{
					// https://www.chartjs.org/docs/latest/configuration/device-pixel-ratio.html
					devicePixelRatio: window.devicePixelRatio,
					responsive: true,
					scales: 
					{
						y1: 
						{
							display: true,
							beginAtZero: true,
							position: "left",
							
							title: 
							{
								display: true,
								text: "Y1 Axis",
								color: "#9ad0f5",
								
								font:
								{
									size: 24,
									weight: "bold"
								}	
							}
						}
					}
				}
			}

			// Construct chart based on configurations.
			const BasicChart = new Chart(ctx, ChartConfig);
			
			// Change chart size based on browser size.
			window.onresize = function()
			{
				BasicChart.resize();
				BasicChart.update();
				BasicChart.render();
			}

			//Add new dataset to the chart. For example, multiple bar or lines. Supported types are "bar", "line", "pie", "doughnut", "polarArea", "radar".
			function dataset_add(newColor, newAxisId, newLabel, newBorderWidth, newType)
			{
				BasicChart.data.datasets.push(
					{
						backgroundColor: newColor,
						yAxisID: newAxisId,
						label : newLabel,
						borderWidth : newBorderWidth,
						type: newType
					}
				);

				BasicChart.update();
				BasicChart.render();
			}
			dataset_add("red", "y2", "Unreal Dataset", 3, "bar");

			// Change label of target dataset.
			function dataset_change_label(indexDataset, newLabel)
			{
				const targetDataSet = BasicChart.data.datasets[indexDataset];
				if(targetDataSet == null)
				{
					console.log("Target dataset is null.")
					return;
				}

				targetDataSet.label = newLabel;
				
				BasicChart.update();
				BasicChart.render();
			}
			//dataset_change_label(1, "Unreal Dataset New Name");

			function data_add(indexDataset, newName, newValue, deleteBefore)
			{
				const targetDataSet = BasicChart.data.datasets[indexDataset];
				if(targetDataSet == null)
				{
					console.log("Target dataset is null.")
					return;
				}

				if(newName !== null)
				{
					if(deleteBefore)
					{
						BasicChart.data.labels.splice(0, Object.keys(newName).length);
					}

					newName.forEach(element => 
					{
						BasicChart.data.labels.push(element);
					});
				}

				if(newValue !== null)
				{
					if(deleteBefore)
					{
						targetDataSet.data.splice(0, Object.keys(newValue).length);
					}

					if(newName !== null || BasicChart.data.labels.lenght > 0)
					{
						newValue.forEach(element =>
						{
							targetDataSet.data.push(element);
						});
					}
					
					else
					{
						console.log("There is no label for value.")
					}
				}
				
				BasicChart.update();
				BasicChart.render();
			}
			data_add(0, ['eray', 'burak', 'mustafa'], [10, 5, 9], false);
			//data_add(0, ['c++', 'flutter', 'adeko'], [20, 10, 18], true);

			// Add new data to the target dataset.
			function data_remove(indexDataset, indexValue, count, bDeleteLabel, bSetZero)
			{
				const targetDataSet = BasicChart.data.datasets[indexDataset];
				if(targetDataSet == null)
				{
					console.log("Target dataset is null.")
					return;
				}

				if(bSetZero)
				{
					targetDataSet.data[indexValue] = 0;
				}

				else
				{
					targetDataSet.data.splice(indexValue, count);
				}

				if(bDeleteLabel && !bSetZero)
				{
					BasicChart.data.labels.splice(indexValue, count);
				}

				BasicChart.update();
				BasicChart.render();
			}
			//data_remove(0, 1, 1, true, false); // This will delete second entry completely. "bSetZero" have to be false. 
			//data_remove(0, 1, 1, false, true); // This will make second entry to 0. "bDeleteLabel" can be true or false. It won't matter.

			function data_update_label(indexDataset, indexLabel, newLabel)
			{
				if(BasicChart.data.labels[indexLabel] == null)
				{
					console.log("Target label is null.")
					return;
				}

				BasicChart.data.labels[indexLabel] = newLabel;

				BasicChart.update();
				BasicChart.render();
			}
			//data_update_label(0, 0, "Unreal");

			function data_update_value(indexDataset, indexValue, newValue)
			{
				if(BasicChart.data.datasets[indexDataset] == null)
				{
					console.log("Target dataset is null.")
					return;
				}

				if(BasicChart.data.datasets[indexDataset].data[indexValue] == null)
				{
					console.log("Target data is null.")
					return;
				}

				BasicChart.data.datasets[indexDataset].data[indexValue] = newValue;

				BasicChart.update();
				BasicChart.render();
			}
			//data_update_value(0, 0, 100);

			function axis_set_style(axisId, newDisplay, newBeginAtZero, newAxisTitle, newColor, newPosition, newFontSize, newFontWeight)
			{
				const targetAxis = BasicChart.options.scales[axisId];
				if (targetAxis == null)
				{
					console.log("Target axis is null.");
					return;
				}

				targetAxis.display = newDisplay;
				targetAxis.beginAtZero = newBeginAtZero;
				targetAxis.position = newPosition;
				
				targetAxis.title.display = true;
				targetAxis.title.text = newAxisTitle;
				targetAxis.title.color = newColor;

				targetAxis.title.font = 
				{
					size: newFontSize,
					weight: newFontWeight
				}

				BasicChart.update();
				BasicChart.render();
			}
			axis_set_style("y2", true, true, "New Axis", "red", "left", 24, "bold");

			function axis_add_grid(axisId, threshold, smallerColor, biggerColor, equalColor)
			{
				const targetAxis = BasicChart.options.scales[axisId];
				if(targetAxis == null)
				{
					console.log("Target axis is null.");
					return;
				}
				
				targetAxis.grid =
				{
					color: function(context) 
								{
            						if (context.tick.value < threshold)
									{
              							return smallerColor;
            						}
									
									else if (context.tick.value > threshold) 
									{
              							return biggerColor;
            						}
						
									return equalColor;
								}
				}

				BasicChart.update();
				BasicChart.render();
			}
			//axis_add_grid('y1', 10, "red", "green", "black");

		</script>
	</body>
</html>